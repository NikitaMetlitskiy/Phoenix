<template>
  <div class="accommodation-features container">
    <svg class="accommodation-features__dotted-line" width="960" height="404" viewBox="0 0 960 404" fill="none" xmlns="http://www.w3.org/2000/svg">
      <clipPath id="featuresLine1">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.333336 3.35833L0.333336 0L1.66667 -5.82819e-08L1.66667 3.35833L0.333336 3.35833ZM0.333337 16.7917L0.333336 10.075L1.66667 10.075L1.66667 16.7917L0.333337 16.7917ZM0.333337 30.225L0.333337 23.5083L1.66667 23.5083L1.66667 30.225L0.333337 30.225ZM0.333338 43.6583L0.333337 36.9417L1.66667 36.9417L1.66667 43.6583L0.333338 43.6583ZM0.333338 57.0917L0.333338 50.375L1.66667 50.375L1.66667 57.0917L0.333338 57.0917ZM0.333339 70.525L0.333339 63.8083L1.66667 63.8083L1.66667 70.525L0.333339 70.525ZM0.33334 83.9583L0.333339 77.2417L1.66667 77.2417L1.66667 83.9583L0.33334 83.9583ZM0.33334 97.3917L0.33334 90.675L1.66667 90.675L1.66667 97.3917L0.33334 97.3917ZM0.333341 110.825L0.33334 104.108L1.66667 104.108L1.66667 110.825L0.333341 110.825ZM0.333341 124.258L0.333341 117.542L1.66667 117.542L1.66667 124.258L0.333341 124.258ZM0.333342 137.692L0.333342 130.975L1.66667 130.975L1.66668 137.692L0.333342 137.692ZM0.333342 151.125L0.333342 144.408L1.66668 144.408L1.66668 151.125L0.333342 151.125ZM0.333343 164.558L0.333343 157.842L1.66668 157.842L1.66668 164.558L0.333343 164.558ZM0.333344 177.992L0.333343 171.275L1.66668 171.275L1.66668 177.992L0.333344 177.992ZM0.333344 191.425L0.333344 184.708L1.66668 184.708L1.66668 191.425L0.333344 191.425ZM0.333345 204.858L0.333345 198.142L1.66668 198.142L1.66668 204.858L0.333345 204.858ZM0.333345 218.292L0.333345 211.575L1.66668 211.575L1.66668 218.292L0.333345 218.292ZM0.333346 231.725L0.333346 225.008L1.66668 225.008L1.66668 231.725L0.333346 231.725ZM0.333347 245.158L0.333346 238.442L1.66668 238.442L1.66668 245.158L0.333347 245.158ZM0.333347 258.592L0.333347 251.875L1.66668 251.875L1.66668 258.592L0.333347 258.592ZM0.333348 272.025L0.333347 265.308L1.66668 265.308L1.66668 272.025L0.333348 272.025ZM0.333348 285.458L0.333348 278.742L1.66668 278.742L1.66668 285.458L0.333348 285.458ZM0.333349 298.892L0.333349 292.175L1.66668 292.175L1.66668 298.892L0.333349 298.892ZM0.33335 312.325L0.333349 305.608L1.66668 305.608L1.66668 312.325L0.33335 312.325ZM0.33335 325.758L0.33335 319.042L1.66668 319.042L1.66668 325.758L0.33335 325.758ZM0.333351 339.192L0.33335 332.475L1.66668 332.475L1.66668 339.192L0.333351 339.192ZM0.333351 352.625L0.333351 345.908L1.66668 345.908L1.66668 352.625L0.333351 352.625ZM0.333352 366.058L0.333352 359.342L1.66668 359.342L1.66669 366.058L0.333352 366.058ZM0.333352 379.492L0.333352 372.775L1.66669 372.775L1.66669 379.492L0.333352 379.492ZM0.333353 392.925L0.333353 386.208L1.66669 386.208L1.66669 392.925L0.333353 392.925ZM0.333353 403L0.333353 399.642L1.66669 399.642L1.66669 403L0.333353 403Z" fill="#363735"/>
      </clipPath>
      <path opacity="0.16" d="M1 0L1.00002 403" stroke="#363735" stroke-width="1.33333" clip-path="url(#featuresLine1)" ref="featuresLine1"/>
      <clipPath id="featuresLine2">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.33333 403.667L0 403.667L-1.18173e-07 402.333L3.33333 402.333L3.33333 403.667ZM16.6667 403.667L10 403.667L10 402.333L16.6667 402.333L16.6667 403.667ZM30 403.667L23.3333 403.667L23.3333 402.333L30 402.333L30 403.667ZM43.3333 403.667L36.6667 403.667L36.6667 402.333L43.3333 402.333L43.3333 403.667ZM56.6667 403.667L50 403.667L50 402.333L56.6667 402.333L56.6667 403.667ZM70 403.667L63.3333 403.667L63.3333 402.333L70 402.333L70 403.667ZM83.3333 403.667L76.6667 403.667L76.6667 402.333L83.3333 402.333L83.3333 403.667ZM96.6667 403.667L90 403.667L90 402.333L96.6667 402.333L96.6667 403.667ZM110 403.667L103.333 403.667L103.333 402.333L110 402.333L110 403.667ZM123.333 403.667L116.667 403.667L116.667 402.333L123.333 402.333L123.333 403.667ZM136.667 403.667L130 403.667L130 402.333L136.667 402.333L136.667 403.667ZM150 403.667L143.333 403.667L143.333 402.333L150 402.333L150 403.667ZM163.333 403.667L156.667 403.667L156.667 402.333L163.333 402.333L163.333 403.667ZM176.667 403.667L170 403.667L170 402.333L176.667 402.333L176.667 403.667ZM190 403.667L183.333 403.667L183.333 402.333L190 402.333L190 403.667ZM203.333 403.667L196.667 403.667L196.667 402.333L203.333 402.333L203.333 403.667ZM216.667 403.667L210 403.667L210 402.333L216.667 402.333L216.667 403.667ZM230 403.667L223.333 403.667L223.333 402.333L230 402.333L230 403.667ZM243.333 403.667L236.667 403.667L236.667 402.333L243.333 402.333L243.333 403.667ZM256.667 403.667L250 403.667L250 402.333L256.667 402.333L256.667 403.667ZM270 403.667L263.333 403.667L263.333 402.333L270 402.333L270 403.667ZM283.333 403.667L276.667 403.667L276.667 402.333L283.333 402.333L283.333 403.667ZM296.667 403.667L290 403.667L290 402.333L296.667 402.333L296.667 403.667ZM310 403.667L303.333 403.667L303.333 402.333L310 402.333L310 403.667ZM323.333 403.667L316.667 403.667L316.667 402.333L323.333 402.333L323.333 403.667ZM336.667 403.667L330 403.667L330 402.333L336.667 402.333L336.667 403.667ZM350 403.667L343.333 403.667L343.333 402.333L350 402.333L350 403.667ZM363.333 403.667L356.667 403.667L356.667 402.333L363.333 402.333L363.333 403.667ZM376.667 403.667L370 403.667L370 402.333L376.667 402.333L376.667 403.667ZM390 403.667L383.333 403.667L383.333 402.333L390 402.333L390 403.667ZM403.333 403.667L396.667 403.667L396.667 402.333L403.333 402.333L403.333 403.667ZM416.667 403.667L410 403.667L410 402.333L416.667 402.333L416.667 403.667ZM430 403.667L423.333 403.667L423.333 402.333L430 402.333L430 403.667ZM443.333 403.667L436.666 403.667L436.666 402.333L443.333 402.333L443.333 403.667ZM456.666 403.667L450 403.667L450 402.333L456.666 402.333L456.666 403.667ZM470 403.667L463.333 403.667L463.333 402.333L470 402.333L470 403.667ZM483.333 403.667L476.666 403.667L476.666 402.333L483.333 402.333L483.333 403.667ZM496.666 403.667L490 403.667L490 402.333L496.666 402.333L496.666 403.667ZM510 403.667L503.333 403.667L503.333 402.333L510 402.333L510 403.667ZM523.333 403.667L516.666 403.667L516.666 402.333L523.333 402.333L523.333 403.667ZM536.666 403.667L530 403.667L530 402.333L536.666 402.333L536.666 403.667ZM550 403.667L543.333 403.667L543.333 402.333L550 402.333L550 403.667ZM563.333 403.667L556.667 403.667L556.667 402.333L563.333 402.333L563.333 403.667ZM576.667 403.667L570 403.667L570 402.333L576.667 402.333L576.667 403.667ZM590 403.667L583.333 403.667L583.333 402.333L590 402.333L590 403.667ZM603.333 403.667L596.667 403.667L596.667 402.333L603.333 402.333L603.333 403.667ZM616.667 403.667L610 403.667L610 402.333L616.667 402.333L616.667 403.667ZM630 403.667L623.333 403.667L623.333 402.333L630 402.333L630 403.667ZM643.333 403.667L636.667 403.667L636.667 402.333L643.333 402.333L643.333 403.667ZM656.667 403.667L650 403.667L650 402.333L656.667 402.333L656.667 403.667ZM670 403.667L663.333 403.667L663.333 402.333L670 402.333L670 403.667ZM683.334 403.667L676.667 403.667L676.667 402.333L683.334 402.333L683.334 403.667ZM696.667 403.667L690 403.667L690 402.333L696.667 402.333L696.667 403.667ZM710 403.667L703.334 403.667L703.334 402.333L710 402.333L710 403.667ZM723.334 403.667L716.667 403.667L716.667 402.333L723.334 402.333L723.334 403.667ZM736.667 403.667L730 403.667L730 402.333L736.667 402.333L736.667 403.667ZM750 403.667L743.334 403.667L743.334 402.333L750 402.333L750 403.667ZM763.334 403.667L756.667 403.667L756.667 402.333L763.334 402.333L763.334 403.667ZM776.667 403.667L770 403.667L770 402.333L776.667 402.333L776.667 403.667ZM790.001 403.667L783.334 403.667L783.334 402.333L790.001 402.333L790.001 403.667ZM803.334 403.667L796.667 403.667L796.667 402.333L803.334 402.333L803.334 403.667ZM816.667 403.667L810.001 403.667L810.001 402.333L816.667 402.333L816.667 403.667ZM830.001 403.667L823.334 403.667L823.334 402.333L830.001 402.333L830.001 403.667ZM843.334 403.667L836.667 403.667L836.667 402.333L843.334 402.333L843.334 403.667ZM856.667 403.667L850.001 403.667L850.001 402.333L856.667 402.333L856.667 403.667ZM870.001 403.667L863.334 403.667L863.334 402.333L870.001 402.333L870.001 403.667ZM883.334 403.667L876.667 403.667L876.667 402.333L883.334 402.333L883.334 403.667ZM896.668 403.667L890.001 403.667L890.001 402.333L896.668 402.333L896.668 403.667ZM910.001 403.667L903.334 403.667L903.334 402.333L910.001 402.333L910.001 403.667ZM923.334 403.667L916.668 403.667L916.668 402.333L923.334 402.333L923.334 403.667ZM936.668 403.667L930.001 403.667L930.001 402.333L936.668 402.333L936.668 403.667ZM950.001 403.667L943.334 403.667L943.334 402.333L950.001 402.333L950.001 403.667ZM960 403.667L956.668 403.667L956.668 402.333L960 402.333L960 403.667Z" fill="#363735"/>
      </clipPath>
      <path opacity="0.16" d="M0 403L960 403" stroke="#363735" stroke-width="1.33333" clip-path="url(#featuresLine2)" ref="featuresLine2"/>
    </svg>

    <p v-if="title" class="accommodation-features__title h2" ref="title">{{ title }}</p>

    <div class="accommodation-features__inner" ref="featuresInner">
      <ul v-if="featuresList" class="accommodation-features__list" @touchstart="startItemsMove" @touchend="finishItemsMove">
        <li
          class="accommodation-features__list-item"
          v-for="(item, id) in featuresList"
          :key="id"
          ref="card"
        >
          <img
            class="accommodation-features__list-item-icon"
            :src="`${getApiUrl()}${item?.Svg_benefit?.data?.attributes?.url}`"
            alt="features-icon"
          />
          <span class="accommodation-features__list-item-value p1">{{ item?.Description_benefit }}</span>
        </li>
      </ul>

      <div  class="accommodation-features__text p1" ref="text">
        <p v-if="text" class="p1">{{ text }}</p>
      </div>

      <p v-if="subTitle" class="accommodation-features__subtitle h4 block-wrapper" ref="subtitle">{{ subTitle }}</p>
    </div>
  </div>
</template>

<script>
import { animateJS } from "~/plugins/animations";

export default {
  props: {
    title: {
      type: String,
      default: "",
    },
    subTitle: {
      type: String,
      default: "",
    },
    text: {
      type: String,
      default: "",
    },
    featuresList: {
      type: Array,
      default: () => [],
    },
  },
  data(){
    return {
      startPosition: null,
      currentPosition: null,
      offset: 0,
      animation: null
    }
  },
  methods: {
    startItemsMove(event){
      if(window.innerWidth > 767 || this.$refs.card.length < 2) return;

      this.startPosition = event.touches[0].clientX;
      this.currentPosition = event.touches[0].clientX;
      document.addEventListener('touchmove', this.moveHandler);

      this.moveItems();
    },
    moveHandler(event){
      this.currentPosition = event.touches[0].clientX;
    },
    finishItemsMove(){
      this.offset += this.currentPosition - this.startPosition;
      window.cancelAnimationFrame(this.animation);
      document.removeEventListener('touchmove', this.moveHandler);
    },
    moveItems(){
      const cards = this.$refs.card;
      const featuresInnerWidth = this.$refs.featuresInner.getBoundingClientRect().width;
      const rightBorder = cards[0].getBoundingClientRect().width * 2 - featuresInnerWidth;
      const newPosition = Math.min(0, Math.max(-1 * rightBorder, this.offset + (this.currentPosition - this.startPosition)));
      cards.forEach(card => {
        card.style.transform = `translateX(${newPosition}px)`;
      });

      this.animation = requestAnimationFrame(this.moveItems);
    }
  },
  mounted() {
    if (window.innerWidth >= 1024) {
      this.$refs.text.append(this.$refs.subtitle);
    }

    this.$nextTick(() => {
      animateJS('splitTitleLeft', this.$refs.title);
      animateJS('splitTitleLeft', this.$refs.subtitle);
      animateJS('splitText', this.$refs.text);
      animateJS('fadeCards', this.$refs.card);
      animateJS('drawSvg', this.$refs.featuresLine1);
      animateJS('drawSvg', this.$refs.featuresLine2);
    });
  }
};
</script>

<style lang="scss" scoped>
.accommodation-features {
  @include pt-thistle;
  @include pb-thistle;
  position: relative;
}
.accommodation-features__dotted-line{
  position: absolute;
  width: 50%;
  height: unset;
  left: 50%;
  display: none;
  
  @include min(lg){
    top: -100px;
    display: block;
  }
  @include min(bg){
    width: unset;
    top: -92px;
  }
}
.accommodation-features__title {
  margin-left: 0;

  @include min(sm) {
    width: 75%;
  }
  @include min(bg) {
    width: 63%;
  }
}
.accommodation-features__inner {
  @include min(md) {
    display: flex;
    justify-content: space-between;
    position: relative;
  }
}
.accommodation-features__list {
  @include mt-skyblue;
  display: grid;
  grid-template-columns: repeat(2, 260px);
  row-gap: 32px;
  // overflow-x: scroll;
  // overflow-y: hidden;
  overflow: hidden;

  @include min(tb) {
    grid-template-columns: repeat(3, 1fr);
    overflow: hidden;
  }
  @include min(md) {
    width: 50%;
    grid-template-columns: repeat(2, 1fr);
    column-gap: 16px;
  }
  @include min(lg) {
    grid-template-columns: repeat(3, 1fr);
    row-gap: 40px;
    column-gap: 20px;
  }
  @include min(bg) {
    row-gap: 48px;
    column-gap: 24px;
  }
}
.accommodation-features__list-item {
  display: flex;
  align-items: center;
}
.accommodation-features__list-item-icon {
  margin-left: 0;
  margin-right: 14px;
  width: 22px;
  height: 24px;
  object-fit: unset;

  @include min(tb) {
    margin-right: 24px;
    width: 24px;
    height: 27px;
  }
}
.accommodation-features__text {
  @include mt-thistle;
  margin-left: 0;

  @include min(sm) {
    width: 83%;
  }
  @include min(md) {
    @include mt-skyblue;
    // width: 45%;
    width: 380px;
    // position: absolute;
    // right: 0;
    // top: 0;
    .p1 {
      width: 72%;
    }
  }
  @include min(xl) {
    width: 485px;
  }
  @include min(bg) {
    width: 653px;
  }
}
.accommodation-features__subtitle {
  @include mt-cornflowerblue;
  margin-left: 0;

  @include min(sm) {
    width: 83%;
  }
  @include min(md) {
    margin-top: 50px;
    width: 100%;
  }
  @include min(bg){
    margin-top: 62px;
  }
}
</style>